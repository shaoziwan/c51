C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CHENGXU
OBJECT MODULE PLACED IN chengxu.OBJ
COMPILER INVOKED BY: E:\学习\C51\BIN\C51.EXE chengxu.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /******************************************************
   2          ******************************************************/
   3          #include <REG51.H>
   4          #include <intrins.h>
   5          #define uint unsigned int
   6          #define uchar unsigned char
   7          //延时子程序模块
   8          //**********************************************
   9          void mdelay(uint delay)
  10          {
  11   1          uint i;
  12   1          for(; delay>0; delay--)
  13   1          {
  14   2              for(i=0; i<80; i++) //1ms延时.
  15   2              {
  16   3                  ;
  17   3              }
  18   2          }
  19   1      }
  20          
  21          //************************************************
  22          
  23          void show();   //液晶显示程序
  24          //****************************************
  25          //12864液晶显示部分子程序模块
  26          //****************************************
  27          sbit K8         = P0^4;
  28          sbit K7         = P0^3;
  29          sbit K6         = P0^2;
  30          
  31          sbit K5         = P0^1;
  32          sbit K4         = P0^0;
  33          
  34          sbit K1         = P1^0;
  35          
  36          sbit K2         = P1^1;
  37          sbit K3         = P1^2;
  38          
  39          
  40          sbit K11        = P3^2;
  41          sbit K12        = P3^3;
  42          sbit K13        = P3^4;
  43          sbit K14        = P3^5;
  44          sbit K15        = P3^6;
  45          
  46          
  47          
  48          sbit DJ=P1^4;
  49          
  50          sbit rs         = P0^5;
  51          sbit rw         = P0^6;
  52          sbit e          = P0^7;
  53          sbit beep = P1^5;
  54          #define lcddata P2
  55          
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 2   

  56          unsigned char count=0,m=30,n,nn,money=0,du;                     //定义计数变量
  57          
  58          uchar t1=0,t2=5,t3=5,t4=5,t5=0;
  59          
  60          uchar Time[6];
  61          
  62          uchar info[] = "hello world";
  63          
  64          sbit busy=P0^7;   //lcd busy bit
  65          void wr_d_lcd(uchar content);
  66          void wr_i_lcd(uchar content);
  67          void clrram_lcd (void);
  68          void init_lcd(void);
  69          void busy_lcd(void);
  70          void rev_row_lcd(uchar row);
  71          void rev_co_lcd(uchar row,uchar col,uchar mode);
  72          void clr_lcd(void);
  73          void wr_co_lcd(uchar row,uchar col,uchar lcddata1,uchar lcddtta2);
  74          void wr_row_lcd(uchar row,char *p);
  75          //*******************************************************************                                     
             -                           */
  76          //因为引脚的定义DB0..DB7是从P1.7...P1.0排列的                                                    */
  77          //所以顺序需要调换一下
  78          //*******************************************************************
  79          uchar swapbit(uchar udata)
  80          {
  81   1          uchar ii,tmp=0;
  82   1          for(ii=0; ii<8; ii++)
  83   1          {
  84   2              tmp<<=1;
  85   2              if(udata&0x01)
  86   2              {
  87   3                  tmp|=0x01;
  88   3              }
  89   2              udata>>=1;
  90   2          }
  91   1          return tmp;
  92   1      }
  93          //**********************************
  94          //液晶初始化
  95          //**********************************
  96          void init_lcd(void)
  97          {
  98   1          wr_i_lcd(0x06);  /*光标的移动方向*/
  99   1          wr_i_lcd(0x0c);  /*开显示，关游标*/
 100   1      }
 101          //***********************************
 102          //填充液晶DDRAM全为空格
 103          //**********************************
 104          void clrram_lcd (void)
 105          {
 106   1          wr_i_lcd(0x30);
 107   1          wr_i_lcd(0x01);
 108   1      }
 109          //***********************************
 110          //对液晶写数据
 111          //content为要写入的数据
 112          //***********************************
 113          void wr_d_lcd(uchar content)
 114          {
 115   1      //      busy_lcd();
 116   1          rs=1;
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 3   

 117   1          rw=0;
 118   1          lcddata=swapbit(content);
 119   1          e=1;
 120   1          ;
 121   1          e=0;
 122   1      }
 123          //********************************
 124          //对液晶写指令
 125          //content为要写入的指令代码
 126          //*****************************
 127          void wr_i_lcd(uchar content)
 128          {
 129   1      //      busy_lcd();
 130   1          rs=0;
 131   1          rw=0;
 132   1          lcddata=swapbit(content);
 133   1          e=1;
 134   1          ;
 135   1          e=0;
 136   1      }
 137          //********************************
 138          //液晶检测忙状态
 139          //在写入之前必须执行
 140          //********************************
 141          void busy_lcd(void)
 142          {
 143   1          lcddata=0xff;
 144   1          rs=0;
 145   1          rw=1;
 146   1          e =1;
 147   1          while(busy==1);
 148   1          e =0;
 149   1      }
 150          //********************************
 151          //指定要显示字符的坐标
 152          //*******************************
 153          void gotoxy(unsigned char y, unsigned char x)
 154          {
 155   1          if(y==1)
 156   1              wr_i_lcd(0x80|x);
 157   1          if(y==2)
 158   1              wr_i_lcd(0x90|x);
 159   1          if(y==3)
 160   1              wr_i_lcd((0x80|x)+8);
 161   1          if(y==4)
 162   1              wr_i_lcd((0x90|x)+8);
 163   1      }
 164          //**********************************
 165          //液晶显示字符串程序
 166          //**********************************
 167          void print(uchar *str)
 168          {
 169   1          while(*str!='\0')
 170   1          {
 171   2              wr_d_lcd(*str);
 172   2              str++;
 173   2          }
 174   1      }
 175          
 176          //***************************************
 177          //液晶显示主程序模块
 178          //***************************************
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 4   

 179          void show()
 180          {         
 181   1          if(nn<10)
 182   1          {
 183   2              gotoxy(1,0);
 184   2              print("按键选择货物：   ");
 185   2              mdelay(10);
 186   2                      
 187   2      
 188   2      
 189   2      
 190   2              gotoxy(2,0);
 191   2              print("①矿泉水(1元)  ");
 192   2              mdelay(10); 
 193   2      
 194   2                      Time[0]=t1+'0';
 195   2              Time[1]='\0';
 196   2              gotoxy(2,7);
 197   2                      print(Time);
 198   2                      
 199   2                     
 200   2      
 201   2      
 202   2      
 203   2      
 204   2              gotoxy(3,0);
 205   2              print("②红茶(3元)   ");
 206   2              mdelay(10);     //扫描延时
 207   2      
 208   2                      Time[0]=t2+'0';
 209   2            
 210   2              Time[1]='\0';
 211   2              gotoxy(3,7);
 212   2                      print(Time);
 213   2      
 214   2      
 215   2              gotoxy(4,0);
 216   2              print("③绿茶(4元)  ");
 217   2              mdelay(10);                 //扫描延时
 218   2      
 219   2                      Time[0]=t3+'0';
 220   2              Time[1]='\0';
 221   2              gotoxy(4,7);
 222   2                      print(Time);
 223   2      
 224   2      
 225   2      
 226   2          }
 227   1          if(nn==10)
 228   1              { clrram_lcd ();}
 229   1          if(nn>=11)
 230   1          {
 231   2      
 232   2              gotoxy(1,0);
 233   2              print("④啤酒(5元)  ");
 234   2              mdelay(10);
 235   2      
 236   2                      Time[0]=t4+'0';
 237   2              Time[1]='\0';
 238   2              gotoxy(1,7);
 239   2                      print(Time);
 240   2      
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 5   

 241   2              gotoxy(2,0);
 242   2              print("⑤红牛(6元)  ");
 243   2              mdelay(10);                 //扫描延时
 244   2      
 245   2                      Time[0]=t5+'0';
 246   2              Time[1]='\0';
 247   2              gotoxy(2,7);
 248   2                      print(Time);
 249   2      
 250   2              gotoxy(3,0);
 251   2              print("选定后投入硬币");
 252   2              mdelay(10);     //扫描延时
 253   2          }
 254   1      
 255   1      }
 256          
 257          //***************************************
 258          //按键选择货物
 259          //***************************************
 260          
 261          void key()
 262          {
 263   1          
 264   1                if(K11==0)
 265   1                  {
 266   2                      while(K11==0);
 267   2                      mdelay(10);
 268   2                      t1=t1+1;
 269   2                  }
 270   1                              else if(K12==0)
 271   1                  {
 272   2                      while(K12==0);
 273   2                      mdelay(10);
 274   2                      t2=t2+1;
 275   2                  }
 276   1                                      else if(K13==0)
 277   1                  {
 278   2                      while(K13==0);
 279   2                      mdelay(10);
 280   2                      t3=t3+1;
 281   2                  }
 282   1                                      else if(K14==0)
 283   1                  {
 284   2                      while(K14==0);
 285   2                      mdelay(10);
 286   2                      t4=t4+1;
 287   2                  }
 288   1                                      else if(K15==0)
 289   1                  {
 290   2                      while(K15==0);
 291   2                      mdelay(10);
 292   2                      t5=t5+1;
 293   2                  }
 294   1                              
 295   1                                      
 296   1              
 297   1              
 298   1              if(K4==0)//按键1
 299   1          {   
 300   2                  if(t1>0)
 301   2                      {  t1--;
 302   3                      m=30;
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 6   

 303   3              clrram_lcd ();
 304   3              while(1)
 305   3              {
 306   4                  if(m==6)beep=0;
 307   4                  if(m==5)beep=1;
 308   4                  if(m==0)
 309   4                  {
 310   5                      if(0<money)
 311   5                      {
 312   6                          clrram_lcd ();
 313   6                          gotoxy(1,0);
 314   6                          print("投币不足购买失败");
 315   6                          mdelay(10);
 316   6                          gotoxy(2,0);
 317   6                          print("退钱：    元");
 318   6                          mdelay(10);
 319   6                          Time[0]=money/10+'0';
 320   6                          Time[1]='.';
 321   6                          Time[2]=money%10+'0';
 322   6                          Time[3]='\0';
 323   6                          gotoxy(2,3);
 324   6                          print(Time);
 325   6                          mdelay(6000);
 326   6                          money=0;
 327   6                      }
 328   5      
 329   5                      clrram_lcd ();
 330   5                      break;
 331   5                  }
 332   4      
 333   4                  gotoxy(1,0);
 334   4                  print("已选矿泉水");
 335   4                  mdelay(10);
 336   4      
 337   4                  gotoxy(2,0);
 338   4                  print("货物价格:1元");
 339   4                  mdelay(10);
 340   4      
 341   4                  gotoxy(3,0);
 342   4                  print("投币金额:     元");
 343   4                  mdelay(10);
 344   4      
 345   4                  gotoxy(4,0);
 346   4                  print("规定时间：");
 347   4                  mdelay(10);
 348   4      
 349   4      
 350   4                  if(n==0)
 351   4                  {
 352   5                      gotoxy(3,5);
 353   5                      print(Time);
 354   5                      mdelay(100);
 355   5                  }
 356   4      
 357   4                  if(n==1)
 358   4                  {
 359   5                      gotoxy(4,7);
 360   5                      print(Time);
 361   5                      mdelay(10);
 362   5                  }
 363   4      
 364   4                  if(K1==0)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 7   

 365   4                  {
 366   5                      while(K1==0);
 367   5                      mdelay(10);
 368   5                      money=money+100;
 369   5                  }
 370   4      
 371   4                  if(K2==0)
 372   4                  {
 373   5                      while(K2==0);
 374   5                      mdelay(10);
 375   5                      money=money+50;
 376   5                  }
 377   4      
 378   4                  if(K3==0)
 379   4                  {
 380   5                      while(K3==0);
 381   5                      mdelay(10);
 382   5                      money=money+10;
 383   5                  }
 384   4                  if(money>=10)
 385   4                  {
 386   5                      clrram_lcd ();
 387   5                      gotoxy(1,0);
 388   5                      print("矿泉水购买成功");
 389   5                      mdelay(10);
 390   5                      gotoxy(2,0);
 391   5                      print("找钱：    元");
 392   5                      mdelay(10);
 393   5      
 394   5                      du=money-10;
 395   5                      Time[0]=du/10+'0';
 396   5                      Time[1]='.';
 397   5                      Time[2]=du%10+'0';
 398   5                      Time[3]='\0';
 399   5                      gotoxy(2,3);
 400   5                      print(Time);
 401   5                                      DJ=0;
 402   5                      mdelay(6000);
 403   5                                      DJ=1;
 404   5                      money=0;
 405   5                      clrram_lcd ();
 406   5                      break;
 407   5      
 408   5                  }
 409   4              }
 410   3                      }
 411   2          }
 412   1      
 413   1      
 414   1          if(K5==0)//按键2
 415   1          {   if(t2>0)
 416   2                      {  t2--;
 417   3              
 418   3                      m=30;
 419   3              clrram_lcd ();
 420   3              while(1)
 421   3              {
 422   4                  if(m==6)beep=0;
 423   4                  if(m==5)beep=1;
 424   4                  if(m==0)
 425   4                  {
 426   5                      if(0<money<30)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 8   

 427   5                      {
 428   6                          clrram_lcd ();
 429   6                          gotoxy(1,0);
 430   6                          print("投币不足购买失败");
 431   6                          mdelay(10);
 432   6                          gotoxy(2,0);
 433   6                          print("退钱：    元");
 434   6                          mdelay(10);
 435   6                          Time[0]=money/10+'0';
 436   6                          Time[1]='.';
 437   6                          Time[2]=money%10+'0';
 438   6                          Time[3]='\0';
 439   6                          gotoxy(2,3);
 440   6                          print(Time);
 441   6                          mdelay(6000);
 442   6                          money=0;
 443   6                      }
 444   5      
 445   5                      clrram_lcd ();
 446   5                      break;
 447   5                  }
 448   4      
 449   4                  gotoxy(1,0);
 450   4                  print("已选红茶");
 451   4                  mdelay(10);
 452   4      
 453   4                  gotoxy(2,0);
 454   4                  print("货物价格:3元");
 455   4                  mdelay(10);
 456   4      
 457   4                  gotoxy(3,0);
 458   4                  print("投币金额:     元");
 459   4                  mdelay(10);
 460   4      
 461   4                  gotoxy(4,0);
 462   4                  print("规定时间：");
 463   4                  mdelay(10);
 464   4      
 465   4      
 466   4                  if(n==0)
 467   4                  {
 468   5                      gotoxy(3,5);
 469   5                      print(Time);
 470   5                      mdelay(100);
 471   5                  }
 472   4      
 473   4                  if(n==1)
 474   4                  {
 475   5                      gotoxy(4,7);
 476   5                      print(Time);
 477   5                      mdelay(10);
 478   5                  }
 479   4      
 480   4                  if(K1==0)
 481   4                  {
 482   5                      while(K1==0);
 483   5                      mdelay(10);
 484   5                      money=money+100;
 485   5                  }
 486   4      
 487   4                  if(K2==0)
 488   4                  {
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 9   

 489   5                      while(K2==0);
 490   5                      mdelay(10);
 491   5                      money=money+50;
 492   5                  }
 493   4      
 494   4                  if(K3==0)
 495   4                  {
 496   5                      while(K3==0);
 497   5                      mdelay(10);
 498   5                      money=money+10;
 499   5                  }
 500   4                  if(money>=30)
 501   4                  {
 502   5                      clrram_lcd ();
 503   5                      gotoxy(1,0);
 504   5                      print("红茶购买成功");
 505   5                      mdelay(10);
 506   5                      gotoxy(2,0);
 507   5                      print("找钱：    元");
 508   5                      mdelay(10);
 509   5      
 510   5                      du=money-30;
 511   5                      Time[0]=du/10+'0';
 512   5                      Time[1]='.';
 513   5                      Time[2]=du%10+'0';
 514   5                      Time[3]='\0';
 515   5                      gotoxy(2,3);
 516   5                      print(Time);
 517   5                                      DJ=0;
 518   5                      mdelay(6000);
 519   5                                      DJ=1;
 520   5                    
 521   5                      money=0;
 522   5                      clrram_lcd ();
 523   5                      break;
 524   5      
 525   5                  }
 526   4              }
 527   3                      }
 528   2      
 529   2          }
 530   1      
 531   1      
 532   1      
 533   1          if(K6==0)//按键3
 534   1          {   if(t3>0)
 535   2                      {  t3--;
 536   3              m=30;
 537   3              clrram_lcd ();
 538   3                      while(1)
 539   3              {
 540   4                              if(m==6)beep=0;
 541   4                  if(m==5)beep=1;
 542   4                  if(m==0)
 543   4                  {
 544   5                      if(0<money<40)
 545   5                      {
 546   6                          clrram_lcd ();
 547   6                          gotoxy(1,0);
 548   6                          print("投币不足购买失败");
 549   6                          mdelay(10);
 550   6                          gotoxy(2,0);
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 10  

 551   6                          print("退钱：    元");
 552   6                          mdelay(10);
 553   6                          Time[0]=money/10+'0';
 554   6                          Time[1]='.';
 555   6                          Time[2]=money%10+'0';
 556   6                          Time[3]='\0';
 557   6                          gotoxy(2,3);
 558   6                          print(Time);
 559   6                          mdelay(6000);
 560   6                          money=0;
 561   6                      }
 562   5      
 563   5                      clrram_lcd ();
 564   5                      break;
 565   5                  }
 566   4      
 567   4                  gotoxy(1,0);
 568   4                  print("已选绿茶");
 569   4                  mdelay(10);
 570   4      
 571   4                  gotoxy(2,0);
 572   4                  print("货物价格:4元");
 573   4                  mdelay(10);
 574   4      
 575   4                  gotoxy(3,0);
 576   4                  print("投币金额:     元");
 577   4                  mdelay(10);
 578   4      
 579   4                  gotoxy(4,0);
 580   4                  print("规定时间：");
 581   4                  mdelay(10);
 582   4      
 583   4      
 584   4                  if(n==0)
 585   4                  {
 586   5                      gotoxy(3,5);
 587   5                      print(Time);
 588   5                      mdelay(100);
 589   5                  }
 590   4      
 591   4                  if(n==1)
 592   4                  {
 593   5                      gotoxy(4,7);
 594   5                      print(Time);
 595   5                      mdelay(10);
 596   5                  }
 597   4      
 598   4                  if(K1==0)
 599   4                  {
 600   5                      while(K1==0);
 601   5                      mdelay(10);
 602   5                      money=money+100;
 603   5                  }
 604   4      
 605   4                  if(K2==0)
 606   4                  {
 607   5                      while(K2==0);
 608   5                      mdelay(10);
 609   5                      money=money+50;
 610   5                  }
 611   4      
 612   4                  if(K3==0)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 11  

 613   4                  {
 614   5                      while(K3==0);
 615   5                      mdelay(10);
 616   5                      money=money+10;
 617   5                  }
 618   4                  if(money>=40)
 619   4                  {
 620   5                      clrram_lcd ();
 621   5                      gotoxy(1,0);
 622   5                      print("绿茶购买成功");
 623   5                      mdelay(10);
 624   5                      gotoxy(2,0);
 625   5                      print("找钱：    元");
 626   5                      mdelay(10);
 627   5      
 628   5                      du=money-40;
 629   5                      Time[0]=du/10+'0';
 630   5                      Time[1]='.';
 631   5                      Time[2]=du%10+'0';
 632   5                      Time[3]='\0';
 633   5                      gotoxy(2,3);
 634   5                      print(Time);
 635   5                                       DJ=0;
 636   5                      mdelay(6000);
 637   5                                      DJ=1;
 638   5                     
 639   5                      money=0;
 640   5                      clrram_lcd ();
 641   5                      break;
 642   5      
 643   5                  }
 644   4              }
 645   3                      }
 646   2      
 647   2          }
 648   1      
 649   1      
 650   1      
 651   1          if(K7==0)//按键4
 652   1          {   if(t4>0)
 653   2                      {       t4--;
 654   3              m=30;
 655   3              clrram_lcd ();
 656   3              while(1)
 657   3              {       
 658   4              if(m==6)beep=0;
 659   4              if(m==5)beep=1;
 660   4                  if(m==0)
 661   4                  {
 662   5                      if(0<money<50)
 663   5                      {
 664   6                          clrram_lcd ();
 665   6                          gotoxy(1,0);
 666   6                          print("投币不足购买失败");
 667   6                          mdelay(10);
 668   6                          gotoxy(2,0);
 669   6                          print("退钱：    元");
 670   6                          mdelay(10);
 671   6                          Time[0]=money/10+'0';
 672   6                          Time[1]='.';
 673   6                          Time[2]=money%10+'0';
 674   6                          Time[3]='\0';
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 12  

 675   6                          gotoxy(2,3);
 676   6                          print(Time);
 677   6                          mdelay(6000);
 678   6                          money=0;
 679   6                      }
 680   5      
 681   5                      clrram_lcd ();
 682   5                      break;
 683   5                  }
 684   4      
 685   4                  gotoxy(1,0);
 686   4                  print("已选啤酒");
 687   4                  mdelay(10);
 688   4      
 689   4                  gotoxy(2,0);
 690   4                  print("货物价格:5元");
 691   4                  mdelay(10);
 692   4      
 693   4                  gotoxy(3,0);
 694   4                  print("投币金额:     元");
 695   4                  mdelay(10);
 696   4      
 697   4                  gotoxy(4,0);
 698   4                  print("规定时间：");
 699   4                  mdelay(10);
 700   4      
 701   4      
 702   4                  if(n==0)
 703   4                  {
 704   5                      gotoxy(3,5);
 705   5                      print(Time);
 706   5                      mdelay(100);
 707   5                  }
 708   4      
 709   4                  if(n==1)
 710   4                  {
 711   5                      gotoxy(4,7);
 712   5                      print(Time);
 713   5                      mdelay(10);
 714   5                  }
 715   4      
 716   4                  if(K1==0)
 717   4                  {
 718   5                      while(K1==0);
 719   5                      mdelay(10);
 720   5                      money=money+100;
 721   5                  }
 722   4      
 723   4                  if(K2==0)
 724   4                  {
 725   5                      while(K2==0);
 726   5                      mdelay(10);
 727   5                      money=money+50;
 728   5                  }
 729   4      
 730   4                  if(K3==0)
 731   4                  {
 732   5                      while(K3==0);
 733   5                      mdelay(10);
 734   5                      money=money+10;
 735   5                  }
 736   4                  if(money>=50)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 13  

 737   4                  {
 738   5                      clrram_lcd ();
 739   5                      gotoxy(1,0);
 740   5                      print("啤酒买成功");
 741   5                      mdelay(10);
 742   5                      gotoxy(2,0);
 743   5                      print("找钱：    元");
 744   5                      mdelay(10);
 745   5      
 746   5                      du=money-50;
 747   5                      Time[0]=du/10+'0';
 748   5                      Time[1]='.';
 749   5                      Time[2]=du%10+'0';
 750   5                      Time[3]='\0';
 751   5                      gotoxy(2,3);
 752   5                      print(Time);
 753   5                                      DJ=0;
 754   5                      mdelay(6000);
 755   5                                      DJ=1;
 756   5                      money=0;
 757   5                      clrram_lcd ();
 758   5                      break;
 759   5      
 760   5                  }
 761   4              }
 762   3                      }
 763   2          }
 764   1      
 765   1          if(K8==0)//按键5
 766   1          {  if(t5>0)
 767   2                      {
 768   3                         t5--;
 769   3              m=30;
 770   3              clrram_lcd ();
 771   3              while(1)
 772   3              {
 773   4      
 774   4                         if(m==6)beep=0;
 775   4                 if(m==5)beep=1;
 776   4                  if(m==0)
 777   4                  {
 778   5                      if(0<money<60)
 779   5                      {
 780   6                          clrram_lcd ();
 781   6                          gotoxy(1,0);
 782   6                          print("投币不足购买失败");
 783   6                          mdelay(10);
 784   6                          gotoxy(2,0);
 785   6                          print("退钱：    元");
 786   6                          mdelay(10);
 787   6                          Time[0]=money/10+'0';
 788   6                          Time[1]='.';
 789   6                          Time[2]=money%10+'0';
 790   6                          Time[3]='\0';
 791   6                          gotoxy(2,3);
 792   6                          print(Time);
 793   6                                               mdelay(6000);
 794   6                          money=0;
 795   6                      }
 796   5      
 797   5                      clrram_lcd ();
 798   5                      break;
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 14  

 799   5                  }
 800   4      
 801   4                  gotoxy(1,0);
 802   4                  print("已选红牛");
 803   4                  mdelay(10);
 804   4      
 805   4                  gotoxy(2,0);
 806   4                  print("货物价格:6元");
 807   4                  mdelay(10);
 808   4      
 809   4                  gotoxy(3,0);
 810   4                  print("投币金额:     元");
 811   4                  mdelay(10);
 812   4      
 813   4                  gotoxy(4,0);
 814   4                  print("规定时间：");
 815   4                  mdelay(10);
 816   4      
 817   4      
 818   4                  if(n==0)
 819   4                  {
 820   5                      gotoxy(3,5);
 821   5                      print(Time);
 822   5                      mdelay(100);
 823   5                  }
 824   4      
 825   4                  if(n==1)
 826   4                  {
 827   5                      gotoxy(4,7);
 828   5                      print(Time);
 829   5                      mdelay(10);
 830   5                  }
 831   4      
 832   4                  if(K1==0)
 833   4                  {
 834   5                      while(K1==0);
 835   5                      mdelay(10);
 836   5                      money=money+100;
 837   5                  }
 838   4      
 839   4                  if(K2==0)
 840   4                  {
 841   5                      while(K2==0);
 842   5                      mdelay(10);
 843   5                      money=money+50;
 844   5                  }
 845   4      
 846   4                  if(K3==0)
 847   4                  {
 848   5                      while(K3==0);
 849   5                      mdelay(10);
 850   5                      money=money+10;
 851   5                  }
 852   4                  if(K1==0)
 853   4                  {
 854   5                      while(K1==0);
 855   5                      mdelay(10);
 856   5                      money=money+100;
 857   5                  }
 858   4      
 859   4                  if(K2==0)
 860   4                  {
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 15  

 861   5                      while(K2==0);
 862   5                      mdelay(10);
 863   5                      money=money+50;
 864   5                  }
 865   4      
 866   4                  if(K3==0)
 867   4                  {
 868   5                      while(K3==0);
 869   5                      mdelay(10);
 870   5                      money=money+10;
 871   5                  }
 872   4                  if(money>=60)
 873   4                  {
 874   5                      clrram_lcd ();
 875   5                      gotoxy(1,0);
 876   5                      print("红牛买成功");
 877   5                      mdelay(10);
 878   5                      gotoxy(2,0);
 879   5                      print("找钱：    元");
 880   5                      mdelay(10);
 881   5      
 882   5                      du=money-60;
 883   5                      Time[0]=du/10+'0';
 884   5                      Time[1]='.';
 885   5                      Time[2]=du%10+'0';
 886   5                      Time[3]='\0';
 887   5                      gotoxy(2,3);
 888   5                      print(Time);
 889   5                                      DJ=0;
 890   5                      mdelay(6000);
 891   5                                      DJ=1;
 892   5                      money=0;
 893   5                      clrram_lcd ();
 894   5                      break;
 895   5      
 896   5                  }
 897   4              }
 898   3                      }
 899   2          }
 900   1      }
 901          
 902          void InitUART(void)
 903          {
 904   1          
 905   1              TMOD = 0x21;
 906   1          SCON = 0x50;
 907   1          TH1 = 0xFD;
 908   1          TL1 = TH1;
 909   1          PCON = 0x00;
 910   1          EA = 1;
 911   1          ES = 1;
 912   1          TR1 = 1;
 913   1      }
 914          
 915          void SendOneByte(unsigned char c)
 916          {
 917   1          SBUF = c;
 918   1          while(!TI);
 919   1          TI = 0;
 920   1      }
 921          
 922          void sendData(char *str)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 16  

 923          {
 924   1              int i =0;
 925   1              while(str[i] != '\0')
 926   1                      SendOneByte(str[i++]);
 927   1      }
 928          
 929          
 930          void UARTInterrupt(void) interrupt 4
 931          {
 932   1          if(RI)
 933   1          {
 934   2              RI = 0;
 935   2              //add your code here!
 936   2          }
 937   1      }
 938          
 939          
 940          
 941          //************************************
 942          //主程序
 943          //*************************************
 944          main()
 945          {
 946   1          TMOD=0x01;                                  //T0 工作在方式1 16位计数器
 947   1          TH0=(65536-50000)/256;      //预先 设定定时器 初值,50毫秒
 948   1          TL0=(65536-50000)%256;
 949   1          EA=1;                                               //开启 总中断
 950   1          ET0=1;                                              //开启定时器 0 中断
 951   1          TR0=1;                                              //定时器 0 启动计数
 952   1      
 953   1          init_lcd();
 954   1          clrram_lcd();
 955   1              InitUART();
 956   1              
 957   1      
 958   1          while(1)
 959   1          {
 960   2                
 961   2             key();
 962   2                 sendData(info);
 963   2                 show(); 
 964   2      
 965   2          }
 966   1      }
 967          
 968          
 969          void time0(void)  interrupt 1
 970          {
 971   1          TH0=(65536-50000)/256;              //重新设置定时器 初值,产生50MS定时中断
 972   1          TL0=(65536-50000)%256;
 973   1          count++;                                    //50ms太短，闪烁频率太快
 974   1      
 975   1          if(count==10)
 976   1          {
 977   2              if(n==0)
 978   2              {
 979   3                  Time[0]=m/10+'0';
 980   3      
 981   3                  Time[1]=m%10+'0';
 982   3                  Time[2]='\0';
 983   3              }
 984   2              if(n==1)
C51 COMPILER V9.00   CHENGXU                                                               04/19/2020 16:55:49 PAGE 17  

 985   2              {
 986   3                  Time[0]=money/10+'0';
 987   3                  Time[1]='.';
 988   3                  Time[2]=money%10+'0';
 989   3      
 990   3              }
 991   2                      
 992   2      
 993   2              Time[3]='\0';
 994   2              Time[4]='\0';
 995   2      
 996   2              count=0;
 997   2      
 998   2              if(m==0)m=30;
 999   2      
1000   2              n++;
1001   2              if(n==2)
1002   2              {
1003   3                  m--;
1004   3                  n=0;
1005   3              }
1006   2                      
1007   2                 count=0;
1008   2              nn++;
1009   2              if(nn==20)
1010   2              {
1011   3                  nn=0;
1012   3              }
1013   2          }
1014   1      
1015   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2341    ----
   CONSTANT SIZE    =    352    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     29       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
